<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja de Games</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
 
</head>
<body>  
    <div class="container">        
        
        <div class="row mt-5">
            <div class="col-4">   
                <br>
                <h4>Lista de Jogos</h4>             
                <ul id="games" class="list-group"></ul>  
                                 
            </div>  
            <div class="col-4">
                <br>
                  <h4>Cadastro de Jogo</h4>   
                  <div>               
                      <input type="text" name="titulo" id="titulo" placeholder="Título" class="form-control"> <br>
                     <input type="number" name="ano" id="ano" placeholder="Ano" class="form-control "> <br>
                  <input type="number" name="preco" id="preco" placeholder="Preço" class="form-control "> <br>
                  <button type="button" class="btn btn-primary w-100" onclick="criarJogo()"> Criar </button>
                    </div>
  
              </div>      
            <div id="Buttonteste" class="col-4">
                <br>
                <h4>Editar Jogo</h4>
                <input type="text" name="idEdit" id="idEdit" placeholder="ID" class="form-control " readonly> <br>
                <input type="text" name="tituloEdit" id="tituloEdit" placeholder="Título" class="form-control "> <br>
               <input type="number" name="anoEdit" id="anoEdit" placeholder="Ano" class="form-control"> <br>
            <input type="number" name="precoEdit" id="precoEdit" placeholder="Preço" class="form-control "> <br>
            <button type="button" class="btn btn-danger w-100" onclick="atualizarJogo()"> Editar </button>

            </div>     
              
        </div>  
        <div>           
           
             
             
        </div>    
        
    </div>
    
    
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>

    var axiosConfig = {
        headers: {            
            Authorization: "Bearer " + localStorage.getItem("token")
        }
    }
   

   function criarJogo() {
        var tituloInput = document.getElementById("titulo")
        var anoInput = document.getElementById("ano")
        var precoInput = document.getElementById("preco")

        const campos = {
            titulo: tituloInput.value,
            ano: anoInput.value,
            preco: precoInput.value
        }       

        axios.post('http://localhost:8000/jogos',campos, axiosConfig).then(dados => {
            console.log(dados)

        }).catch(err => {                     
            console.log(err)
            alert("Houveram campos inválidos")
        })   

    } 

    function deleteGame(itemdaLista) {
        var id = itemdaLista.getAttribute("data-id")
        axios.delete('http://localhost:8000/jogos/'+id,axiosConfig).then(resposta => {
            alert("Jogo removido")

            return location.reload()
                       
           
        }).catch(error => {
            console.log(error)
        })

    }

    function carregarFormulario (itemdaLista) {
        var id = itemdaLista.getAttribute("data-id")
        var titulo = itemdaLista.getAttribute("data-titulo")
        var ano = itemdaLista.getAttribute("data-ano")
        var preco = itemdaLista.getAttribute("data-preco")
        document.getElementById("idEdit").value = id
        document.getElementById("tituloEdit").value = titulo
        document.getElementById("anoEdit").value = ano
        document.getElementById("precoEdit").value = preco

    }

    function atualizarJogo() {
        
       var idInput = document.getElementById("idEdit")
        var tituloInput = document.getElementById("tituloEdit")
        var anoInput = document.getElementById("anoEdit")
        var precoInput = document.getElementById("precoEdit")

        const campos = {
            titulo: tituloInput.value,
            ano: anoInput.value,
            preco: precoInput.value
        } 
        
        var id = idInput.value

        axios.put('http://localhost:8000/jogos/'+id,campos, axiosConfig).then(dados => {

            alert("Dados Alterados")
            return location.reload()
            
        }).catch(err => {
            console.log(err)
           alert("Houveram campos inválidos")
        })   

    } 
   
    axios.get('http://localhost:8000/jogos', axiosConfig).then( resposta => {
        var jogos = resposta.data                     
        var list = document.getElementById("games")
        
        jogos.forEach(jogo => {
            var item = document.createElement("li")   
            var breake = document.createElement("br")        
           
          

            item.setAttribute("data-id", jogo.id)
            item.setAttribute("data-titulo", jogo.titulo)
            item.setAttribute("data-ano", jogo.ano)
            item.setAttribute("data-preco", jogo.preco)
            item.innerHTML = `${jogo.titulo} - $${jogo.preco}`


            var deleteBtn = document.createElement("button")
            deleteBtn.innerHTML = "Deletar"
            deleteBtn.classList.add('btn', 'btn-danger', 'd-inline', 'mx-2')

            deleteBtn.addEventListener('click', () => {
                deleteGame(item)
                })

            var editBtn = document.createElement("button")
            editBtn.innerHTML = "Editar"
            editBtn.classList.add('btn', 'btn-primary')

            editBtn.addEventListener("click", () => {
                carregarFormulario(item)
            })

            item.appendChild(breake)                     
            item.appendChild(editBtn)
            item.appendChild(deleteBtn)   
            list.appendChild(item).classList.add("list-group-item")      
        });
        
    }).catch((err) => {
        console.log(err)
        
    });


</script>

</html>